<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Delivery API - –ê–≤—Ç–æ–ª–∞–π—Ç –≠–∫—Å–ø—Ä–µ—Å—Å</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section h3 {
            color: #34495e;
            margin-top: 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #2980b9;
        }
        .response {
            margin-top: 15px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .loading {
            color: #f39c12;
        }
        .error {
            color: #e74c3c;
            background: #fadbd8;
        }
        .success {
            color: #27ae60;
            background: #d5f4e6;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        .input-group input {
            width: 200px;
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöö –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Delivery API</h1>
        <p><strong>–ê–≤—Ç–æ–ª–∞–π—Ç –≠–∫—Å–ø—Ä–µ—Å—Å</strong> - API —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è InSales</p>

        <!-- Health Check -->
        <div class="test-section">
            <h3>ü©∫ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è API</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞</p>
            <button onclick="testHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Health</button>
            <div id="health-response" class="response" style="display:none;"></div>
        </div>

        <!-- Delivery Calculation -->
        <div class="test-section">
            <h3>üí∞ –†–∞—Å—á–µ—Ç –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
            <p>–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –≤–µ—Å—É</p>
            
            <div class="input-group">
                <label for="weight">–í–µ—Å —Ç–æ–≤–∞—Ä–∞ (–∫–≥):</label>
                <input type="number" id="weight" value="2.5" step="0.1" min="0">
            </div>
            
            <div class="input-group">
                <label for="city">–ì–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <input type="text" id="city" value="–ú–∏–Ω—Å–∫">
            </div>
            
            <button onclick="testDeliveryCalc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É</button>
            <div id="delivery-response" class="response" style="display:none;"></div>
        </div>

        <!-- Pickup Points -->
        <div class="test-section">
            <h3>üì¶ –ü—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</h3>
            <p>–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—É–Ω–∫—Ç–æ–≤ –≤—ã–¥–∞—á–∏ –ø–æ –≥–æ—Ä–æ–¥–∞–º</p>
            
            <div class="input-group">
                <label for="pickup-city">–ì–æ—Ä–æ–¥:</label>
                <input type="text" id="pickup-city" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤">
            </div>
            
            <button onclick="testPickupPoints()">–ü–æ–ª—É—á–∏—Ç—å –ø—É–Ω–∫—Ç—ã –≤—ã–¥–∞—á–∏</button>
            <div id="pickup-response" class="response" style="display:none;"></div>
        </div>

        <!-- Pickup Point Calculation -->
        <div class="test-section">
            <h3>üè™ –†–∞—Å—á–µ—Ç –¥–æ –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏</h3>
            <p>–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞</p>
            
            <div class="input-group">
                <label for="pickup-weight">–í–µ—Å —Ç–æ–≤–∞—Ä–∞ (–∫–≥):</label>
                <input type="number" id="pickup-weight" value="2.5" step="0.1" min="0">
            </div>
            
            <button onclick="testPickupCalc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–æ –ü–í–ó</button>
            <div id="pickup-calc-response" class="response" style="display:none;"></div>
        </div>

        <div style="text-align: center; margin-top: 30px; padding: 20px; background: #e8f5e8; border-radius: 8px;">
            <h4>üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å InSales</h4>
            <p>–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL –≤–∞—à–µ–≥–æ Netlify —Å–∞–π—Ç–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –¥–æ—Å—Ç–∞–≤–∫–∏ InSales</p>
            <p><strong>–ü—Ä–∏–º–µ—Ä:</strong> <code>https://–≤–∞—à-—Å–∞–π—Ç.netlify.app/api/delivery/calculate</code></p>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin; // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response ' + (isError ? 'error' : 'success');
            element.textContent = JSON.stringify(data, null, 2);
        }

        function showLoading(elementId, message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response loading';
            element.textContent = message;
        }

        async function testHealth() {
            showLoading('health-response');
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                showResponse('health-response', data);
            } catch (error) {
                showResponse('health-response', { error: error.message }, true);
            }
        }

        async function testDeliveryCalc() {
            const weight = parseFloat(document.getElementById('weight').value) || 0;
            const city = document.getElementById('city').value || '–ú–∏–Ω—Å–∫';
            
            showLoading('delivery-response');
            try {
                const response = await fetch(`${API_BASE}/api/delivery/calculate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        order: { total_weight: weight },
                        shipping_address: { city: city }
                    })
                });
                const data = await response.json();
                showResponse('delivery-response', data);
            } catch (error) {
                showResponse('delivery-response', { error: error.message }, true);
            }
        }

        async function testPickupPoints() {
            const city = document.getElementById('pickup-city').value;
            
            showLoading('pickup-response');
            try {
                const requestBody = city ? { city: city } : {};
                const response = await fetch(`${API_BASE}/api/pickup-points`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();
                showResponse('pickup-response', data);
            } catch (error) {
                showResponse('pickup-response', { error: error.message }, true);
            }
        }

        async function testPickupCalc() {
            const weight = parseFloat(document.getElementById('pickup-weight').value) || 0;
            
            showLoading('pickup-calc-response');
            try {
                const response = await fetch(`${API_BASE}/api/pickup-point/calculate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        order: { total_weight: weight },
                        pickup_point_id: 1
                    })
                });
                const data = await response.json();
                showResponse('pickup-calc-response', data);
            } catch (error) {
                showResponse('pickup-calc-response', { error: error.message }, true);
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º health –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', testHealth);
    </script>
</body>
</html>